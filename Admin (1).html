<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCESS GRANTED | Management Console</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            query, 
            getDocs, 
            doc, 
            updateDoc,
            orderBy,
            writeBatch,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            signOut
        } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
        
        // --- YOUR FIREBASE CONFIGURATION (Confirmed Keys) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAlc-EfD2GFdsSlMGuRou-q4dW1b9btDBQ",
            authDomain: "daman-acc31.firebaseapp.com",
            projectId: "daman-acc31",
            storageBucket: "daman-acc31.firebasestorage.app",
            messagingSenderId: "48848275796",
            appId: "1:48848275796:web:9ed84e8e373c0de6aea0c1",
            measurementId: "G-JDKL7CNN5N"
        };
        // --- END CONFIGURATION ---

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        
        // Export necessary functions to global scope
        window.collection = collection;
        window.query = query;
        window.getDocs = getDocs;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.orderBy = orderBy;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.signOut = signOut;
        window.writeBatch = writeBatch; 
        window.deleteDoc = deleteDoc; 
    </script>

    <style>
        /* --- Hacker Theme CSS --- */
        :root {
            --neon-green: #00FF41; /* Bright Neon Green */
            --dark-background: #111111;
            --text-color: #00FF41;
            --shadow-color: rgba(0, 255, 65, 0.7);
        }

        body {
            font-family: 'Consolas', 'Courier New', monospace;
            margin: 0;
            padding: 0;
            background-color: var(--dark-background);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        #admin-container { 
            max-width: 1400px; 
            margin: 40px auto; 
            padding: 25px; 
            background-color: #0d0d0d; 
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 10px var(--shadow-color);
        }
        
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding-bottom: 20px; 
            border-bottom: 2px solid var(--neon-green); 
            margin-bottom: 25px; 
        }
        
        header h1 { 
            color: var(--neon-green); 
            text-shadow: 0 0 5px var(--shadow-color);
            margin: 0; 
            font-size: 2.2em;
        }
        
        /* New Logo Styles */
        .logo {
            height: 40px; /* Adjust size as needed */
            margin-right: 15px;
            vertical-align: middle;
        }
        
        /* Logo in Login Form */
        #login-form .logo {
            height: 80px; /* Larger size for login screen */
            margin-bottom: 20px;
        }


        /* Logout Button and Action Button Base */
        .logout-btn { 
            background-color: transparent; 
            color: red; 
            border: 1px solid red; 
            padding: 8px 12px; 
            border-radius: 3px; 
            cursor: pointer; 
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.7);
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background-color: red;
            color: var(--dark-background);
            box-shadow: 0 0 10px red;
        }

        /* Inputs and Selects */
        #controls, #search-input, #filter-select {
            background-color: #222;
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 5px var(--shadow-color);
        }

        #controls { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 25px; 
            padding: 15px; 
            border-radius: 0; 
        }

        #search-input, #filter-select { 
            padding: 10px; 
            border-radius: 0; 
            flex: 1; 
        }

        /* Table */
        #user-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px;
        }
        #user-table th, #user-table td { 
            padding: 12px 15px; 
            text-align: left; 
            border: 1px dashed #333; 
        }
        #user-table th { 
            background-color: #000; 
            color: var(--neon-green); 
            text-transform: uppercase; 
            font-size: 14px; 
            text-shadow: none;
            border-bottom: 2px solid var(--neon-green);
        }

        /* Status Colors */
        .status-Approved { color: #00FF00; font-weight: bold; text-shadow: 0 0 5px #00FF00; }
        .status-Pending { color: #FFFF00; font-weight: bold; text-shadow: 0 0 5px #FFFF00; }
        .status-Rejected, .status-Banned { color: #FF0000; font-weight: bold; text-shadow: 0 0 5px #FF0000; }

        /* Action Buttons */
        .action-btn { 
            border: 1px solid; 
            padding: 6px 10px; 
            margin-right: 5px; 
            border-radius: 0; 
            cursor: pointer; 
            font-weight: bold; 
            background-color: transparent;
            color: white;
            transition: all 0.2s;
        }
        .btn-approve { border-color: #00FF00; color: #00FF00; }
        .btn-reject { border-color: #FFFF00; color: #FFFF00; }
        .btn-ban { border-color: #FF0000; color: #FF0000; }
        .btn-delete { border-color: #FF66AA; color: #FF66AA; } /* New Delete Button Color */

        .action-btn:hover {
            opacity: 0.8;
            box-shadow: 0 0 8px currentColor;
        }
        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Insights Section */
        #insights {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 8px var(--shadow-color);
        }
        #insights h2 {
            margin-top: 0;
            color: var(--neon-green);
            text-decoration: underline;
        }
        #stats-grid {
            display: flex;
            gap: 20px;
            justify-content: space-around;
        }
        .stat-box {
            padding: 15px;
            border: 1px dashed #333;
            flex-grow: 1;
            text-align: center;
            font-size: 1.1em;
        }
        .stat-box span {
            display: block;
            font-size: 2em;
            font-weight: bold;
            color: #00FFC0; /* Teal/Cyan for numbers */
            text-shadow: 0 0 5px #00FFFF;
        }
        
        /* Pagination Controls */
        #pagination-controls {
            display: flex; 
            justify-content: space-between; 
            margin-top: 15px; 
            border-top: 1px solid #333; 
            padding-top: 10px;
            align-items: center;
        }
        #page-info {
            font-size: 1.1em; 
            color: #00FFFF;
        }
        #pagination-controls .action-btn {
            padding: 8px 15px;
            border-color: #00AAAA;
            color: #00AAAA;
        }
        
        /* Data Management (Moved to the bottom) */
        #data-management {
            margin-top: 30px; /* Added margin for separation */
            padding: 15px;
            border: 1px solid #FF5555; /* Red border for a dangerous action */
            box-shadow: 0 0 8px #FF0000;
            background-color: #1a0000; /* Darker red background */
        }
        #data-management h2 {
            margin-top: 0;
            color: #FF5555;
            text-decoration: underline;
        }
        #clear-data-btn {
            background-color: #AA0000; 
            border-color: #FF5555; 
            color: white;
            font-size: 1.1em;
            padding: 10px 20px;
            width: 100%;
            margin-top: 10px;
        }
        #clear-data-btn:hover {
            background-color: #FF0000;
            box-shadow: 0 0 15px #FF5555;
        }


        /* --- Login Screen --- */
        #login-screen { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: var(--dark-background); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
        }
        #login-form { 
            background-color: #0d0d0d; 
            padding: 30px; 
            border: 2px solid var(--neon-green);
            box-shadow: 0 0 20px var(--shadow-color); 
            width: 350px; 
            text-align: center; 
        }
        #login-form h2 { 
            margin-top: 0; 
            color: var(--neon-green); 
            text-shadow: 0 0 5px var(--shadow-color);
        }
        #login-email, #login-password { 
            background-color: #222;
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 5px var(--shadow-color);
            width: 100%; 
            padding: 12px; 
            margin: 10px 0; 
            box-sizing: border-box; 
        }
        #login-btn { 
            background-color: var(--neon-green); 
            color: var(--dark-background); 
            border: none; 
            padding: 10px 15px; 
            border-radius: 0; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 15px; 
            font-weight: bold;
            box-shadow: 0 0 10px var(--shadow-color);
        }
        #login-error { 
            color: #FF0000; 
            margin-top: 10px; 
            font-weight: bold; 
            text-shadow: 0 0 3px #FF0000;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="admin-container" class="hidden">
        <header>
            <h1>
                <img src="monsterking.jpg" alt="System Logo" class="logo">
                [[ SYSTEM ACCESS: GRANTED ]]
            </h1>
            <div id="user-info">
                <span id="admin-email"></span>
                <button class="logout-btn" id="logout-btn">LOGOUT</button>
            </div>
        </header>

        <section id="insights">
            <h2>[ SYSTEM_INSIGHTS ]</h2>
            <div id="stats-grid">
                <div class="stat-box">Total Records: <span id="total-users">0</span></div>
                <div class="stat-box">Approved Users (Active): <span id="approved-users">0</span></div>
                <div class="stat-box">Pending Review: <span id="pending-users">0</span></div>
            </div>
        </section>

        <div id="controls">
            <input type="text" id="search-input" placeholder=">> SEARCH UID..." autofocus>
            <select id="filter-select">
                <option value="All">> FILTER: ALL STATUS</option>
                <option value="Pending">> FILTER: PENDING</option>
                <option value="Approved">> FILTER: APPROVED</option>
                <option value="Rejected">> FILTER: REJECTED</option>
                <option value="Banned">> FILTER: BANNED</option>
            </select>
        </div>

        <section id="user-data">
            <p id="loading-status">Connecting to Database...</p> 
            <table id="user-table">
                <thead>
                    <tr>
                        <th>UID</th>
                        <th>STATUS</th>
                        <th>FIRST SEEN</th>
                        <th>ACTIONS</th>
                    </tr>
                </thead>
                <tbody id="user-table-body">
                    </tbody>
            </table>
            <div id="pagination-controls">
                <button id="prev-btn" class="action-btn" disabled>PREV PAGE</button>
                <span id="page-info">Page 1 of 1</span>
                <button id="next-btn" class="action-btn" disabled>NEXT PAGE</button>
            </div>
            </section>
        
        <section id="data-management">
            <h2>[ DATA_MANAGEMENT_0X2B ]</h2>
            <p style="color: #FFCCCC; font-weight: bold;">>> DANGER: This action will permanently clear ALL data from the 30sec, 1min, 3min, and 5min prediction tables.</p>
            <button id="clear-data-btn" class="logout-btn">
                EXECUTE: CLEAR_ALL_PREDICTIONS
            </button>
        </section>
        </div>

    <div id="login-screen">
        <form id="login-form">
            <img src="logo.png" alt="System Logo" class="logo">
            <h2>[[ ADMIN LOGIN REQUIRED ]]</h2>
            <input type="email" id="login-email" placeholder="ACCESS_KEY (Email)" required>
            <input type="password" id="login-password" placeholder="DECRYPT_KEY (Password)" required>
            <button type="submit" id="login-btn">EXECUTE LOGIN</button>
            <p id="login-error" class="hidden"></p>
        </form>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Global Variables and DOM Access ---
        const adminContainer = document.getElementById('admin-container');
        const loginScreen = document.getElementById('login-screen');
        const loginForm = document.getElementById('login-form');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginError = document.getElementById('login-error');
        const loginBtn = document.getElementById('login-btn'); 
        const logoutBtn = document.getElementById('logout-btn');
        const userTableBody = document.getElementById('user-table-body');
        const adminEmailSpan = document.getElementById('admin-email');
        const loadingStatus = document.getElementById('loading-status');
        const searchInput = document.getElementById('search-input');
        const filterSelect = document.getElementById('filter-select');
        const clearDataBtn = document.getElementById('clear-data-btn'); 
        
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageInfo = document.getElementById('page-info');

        // --- Pagination Setup ---
        const USERS_PER_PAGE = 10;
        let currentPage = 1;
        let allUsers = []; 
        let filteredUsersData = []; 
        
        const defaultStatus = "Pending";
        const COLLECTION_NAMES = ['wingo_30sec', 'wingo_1min', 'wingo_3min', 'wingo_5min']; 

        // --- Core Functions ---

        /**
         * Renders the system insights (Total, Approved, Pending users).
         */
        function renderInsights(total, approved, pending) {
            document.getElementById('total-users').textContent = total;
            document.getElementById('approved-users').textContent = approved;
            document.getElementById('pending-users').textContent = pending;
        }

        /**
         * Fetches all user UIDs from Firestore, including those without 'firstSeen'.
         */
        async function fetchUsers() {
            loadingStatus.textContent = "Processing data stream...";
            loadingStatus.classList.remove('hidden');
            
            try {
                const usersColRef = window.collection(window.db, "uid_collection"); 
                
                // 1. Fetch all documents without orderBy to ensure all docs are included (FIX for missing data)
                const q = window.query(usersColRef); 
                
                const snapshot = await window.getDocs(q);
                
                allUsers = snapshot.docs.map(doc => {
                    const data = doc.data();
                    let firstSeenValue = 'N/A';
                    let firstSeenTimestamp = 0; // 0 for sorting 'N/A' items to the end

                    if (data.firstSeen && data.firstSeen.toDate) {
                        const date = data.firstSeen.toDate();
                        firstSeenValue = date.toLocaleString();
                        firstSeenTimestamp = date.getTime();
                    }
                    
                    return {
                        id: doc.id, 
                        uid: data.uid || doc.id, 
                        status: data.status || defaultStatus, 
                        firstSeen: firstSeenValue,
                        firstSeenTimestamp: firstSeenTimestamp // For client-side sorting
                    };
                });
                
                // 2. Client-side sorting (newest first). 
                // Documents with timestamp (new) appear first, 'N/A' (old) appear last.
                allUsers.sort((a, b) => b.firstSeenTimestamp - a.firstSeenTimestamp);

                // --- INSIGHTS CALCULATION ---
                const total = allUsers.length;
                const approvedCount = allUsers.filter(u => u.status === 'Approved').length;
                const pendingCount = allUsers.filter(u => u.status === 'Pending').length;
                
                renderInsights(total, approvedCount, pendingCount); 
                // ---------------------------

                loadingStatus.classList.add('hidden');
                currentPage = 1; 
                filterAndSearchUsers(); 

            } catch (error) {
                console.error("CRITICAL FETCH ERROR:", error); 
                
                let displayMessage = `>> ERROR: CONNECTION FAILURE. Check Database Rules or Network. Message: ${error.message}`;
                loadingStatus.textContent = displayMessage;
                loadingStatus.classList.remove('hidden');
                renderInsights(0, 0, 0); 
            }
        }
        
        // --- Prediction Data Clearance Logic (Batch Delete) ---

        async function deleteAllDocumentsInCollection(colName) {
            let totalDeleted = 0;
            const colRef = window.collection(window.db, colName);
            
            const snapshot = await window.getDocs(colRef); 
            
            if (snapshot.empty) return 0;

            const batch = window.writeBatch(window.db);
            snapshot.docs.forEach(doc => {
                batch.delete(doc.ref);
                totalDeleted++;
            });

            await batch.commit();
            return totalDeleted;
        }

        async function clearAllPredictionData() {
            if (!confirm("SECURITY WARNING: This action will permanently delete ALL prediction data (30s, 1m, 3m, 5m). CONTINUE?")) {
                return;
            }

            clearDataBtn.disabled = true;
            clearDataBtn.textContent = 'CLEANING DATABASE...';
            
            let totalRecordsCleared = 0;

            try {
                for (const colName of COLLECTION_NAMES) {
                    console.log(`[CLEANUP] Starting clearance for ${colName}...`);
                    const deleted = await deleteAllDocumentsInCollection(colName);
                    if (deleted >= 0) {
                        totalRecordsCleared += deleted;
                        console.log(`[CLEANUP SUCCESS] Cleared ${deleted} from ${colName}.`);
                    }
                }
                
                alert(`CLEANUP COMPLETE: Successfully cleared ${totalRecordsCleared} total records from all prediction tables.`);

            } catch (error) {
                console.error("CRITICAL CLEANUP FAILURE:", error);
                alert(`FATAL ERROR: Data clearance failed. Check console for details. Error: ${error.message}`);
            } finally {
                clearDataBtn.disabled = false;
                clearDataBtn.textContent = 'EXECUTE: CLEAR_ALL_PREDICTIONS';
            }
        }
        
        // --- Firebase Logic: Authentication ---

        if (window.auth) {
            window.auth.onAuthStateChanged((user) => {
                if (user) {
                    loginScreen.classList.add('hidden');
                    adminContainer.classList.remove('hidden');
                    adminEmailSpan.textContent = user.email;
                    fetchUsers(); 
                } else {
                    loginScreen.classList.remove('hidden');
                    adminContainer.classList.add('hidden');
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'EXECUTE LOGIN';
                    loginError.classList.add('hidden');
                }
            });
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            loginError.classList.add('hidden');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'AUTHENTICATING...';

            try {
                await window.signInWithEmailAndPassword(window.auth, email, password);
                loginBtn.textContent = 'ACCESS GRANTED'; 
            } catch (error) {
                console.error("Login Error:", error);
                
                let errorMessage = "LOGIN FAILURE: Check ACCESS_KEY/DECRYPT_KEY.";
                if (error.code && (error.code.includes('credential') || error.code.includes('user-not-found') || error.code.includes('wrong-password'))) {
                    errorMessage = "LOGIN FAILURE: INCORRECT KEY or USER NOT FOUND.";
                } else if (error.code && error.code.includes('network')) {
                    errorMessage = "NETWORK ERROR: CHECK CONNECTION.";
                } 
                
                loginError.textContent = errorMessage;
                loginError.classList.remove('hidden');
                
                loginBtn.disabled = false;
                loginBtn.textContent = 'EXECUTE LOGIN';
            }
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await window.signOut(window.auth);
            } catch (error) {
                console.error("Logout Error:", error);
                alert("ERROR: Could not terminate session.");
            }
        });


        // --- Data Display, Pagination, and Action ---

        function updatePaginationControls(totalPages) {
            pageInfo.textContent = `Page ${totalPages === 0 ? 0 : currentPage} of ${totalPages}`;
            
            prevBtn.disabled = (currentPage <= 1);
            nextBtn.disabled = (currentPage >= totalPages);
        }
        
        function renderTable(usersToRender) {
            userTableBody.innerHTML = ''; 
            if (usersToRender.length === 0) {
                userTableBody.innerHTML = '<tr><td colspan="4">>> WARNING: NO RECORDS FOUND MATCHING CRITERIA.</td></tr>';
                return;
            }
            usersToRender.forEach(user => {
                const row = userTableBody.insertRow();
                row.innerHTML = `
                    <td>${user.uid}</td>
                    <td class="status-${user.status}">${user.status}</td>
                    <td>${user.firstSeen}</td>
                    <td>
                        <button class="action-btn btn-approve" data-doc-id="${user.id}" data-action="Approved" 
                                ${user.status === 'Approved' ? 'disabled' : ''}>APPROVE</button>
                        <button class="action-btn btn-reject" data-doc-id="${user.id}" data-action="Rejected"
                                ${user.status === 'Rejected' ? 'disabled' : ''}>REJECT</button>
                        <button class="action-btn btn-ban" data-doc-id="${user.id}" data-action="Banned"
                                ${user.status === 'Banned' ? 'disabled' : ''}>BAN</button>
                        <button class="action-btn btn-delete" data-doc-id="${user.id}" data-action="Delete">DELETE</button>
                    </td>
                `;
            });
            attachActionListeners();
        }

        function attachActionListeners() {
            document.querySelectorAll('.action-btn').forEach(button => {
                const action = button.getAttribute('data-action');
                if (action === 'Delete') {
                    button.removeEventListener('click', handleDeleteAction); 
                    button.addEventListener('click', handleDeleteAction);
                } else {
                    button.removeEventListener('click', handleAction);
                    button.addEventListener('click', handleAction);
                }
            });
        }

        async function handleAction(e) {
            const button = e.target;
            const docId = button.getAttribute('data-doc-id');
            const newStatus = button.getAttribute('data-action');
            
            if (!confirm(`CONFIRM: Change status of UID to ${newStatus}?`)) {
                return;
            }

            button.disabled = true; 
            button.textContent = 'UPDATING...';

            try {
                const docRef = window.doc(window.db, "uid_collection", docId);
                await window.updateDoc(docRef, { status: newStatus });
                
                await fetchUsers(); 
            } catch (error) {
                console.error("Error updating status:", error);
                alert(`ERROR: UPDATE FAILED. Check Permissions.`);
                button.disabled = false;
                button.textContent = newStatus; 
            }
        }
        
        async function handleDeleteAction(e) {
            const button = e.target;
            const docId = button.getAttribute('data-doc-id');
            const uid = button.closest('tr').querySelector('td:first-child').textContent; 

            if (!confirm(`SECURITY WARNING: Permanently delete UID '${uid}'? This action cannot be undone.`)) {
                return;
            }

            button.disabled = true; 
            button.textContent = 'DELETING...';

            try {
                const docRef = window.doc(window.db, "uid_collection", docId);
                await window.deleteDoc(docRef);
                
                await fetchUsers(); // Re-fetch all data to update table and insights
            } catch (error) {
                console.error("Error deleting UID:", error);
                alert(`ERROR: DELETION FAILED. Check Permissions. Message: ${error.message}`);
                button.disabled = false;
                button.textContent = 'DELETE'; 
            }
        }

        function filterAndSearchUsers() {
            const searchText = searchInput.value.toLowerCase().trim();
            const filterStatus = filterSelect.value;

            // 1. Filter based on search/status (from allUsers)
            filteredUsersData = allUsers.filter(user => {
                const matchesSearch = user.uid.toLowerCase().includes(searchText);
                const matchesFilter = filterStatus === 'All' || user.status === filterStatus;
                return matchesSearch && matchesFilter;
            });
            
            // Ensure current page is valid after filtering
            const totalPages = Math.ceil(filteredUsersData.length / USERS_PER_PAGE);
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            } else if (totalPages === 0) {
                currentPage = 0;
            }

            // 2. Calculate pagination limits
            const startIndex = (currentPage - 1) * USERS_PER_PAGE;
            const endIndex = startIndex + USERS_PER_PAGE;
            
            // 3. Slice the array for the current page
            const usersToRender = filteredUsersData.slice(startIndex, endIndex);

            // 4. Render table and update controls
            renderTable(usersToRender);
            updatePaginationControls(totalPages);
        }
        
        // --- Pagination Handlers ---
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredUsersData.length / USERS_PER_PAGE);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        });
        
        function goToPage(pageNumber) {
            currentPage = pageNumber;
            filterAndSearchUsers(); 
            document.getElementById('user-data').scrollIntoView({ behavior: 'smooth' });
        }


        // --- Event Listeners ---
        searchInput.addEventListener('input', () => {
            currentPage = 1; 
            filterAndSearchUsers();
        });
        
        filterSelect.addEventListener('change', () => {
            currentPage = 1; 
            filterAndSearchUsers();
        });
        
        if (clearDataBtn) {
            clearDataBtn.addEventListener('click', clearAllPredictionData);
        }
    });
</script>
</body>
</html>